// ============================================================================
// MODERATION FEATURE MODULE
// Enable with: features.moderation = true
// ============================================================================

model UserViolation {
  id            String            @id @default(cuid())
  userId        String            @map("user_id")
  violationType ViolationType     @map("violation_type")
  severity      ViolationSeverity @default(p2_moderate)
  points        Int               @default(1)
  description   String?
  entityType    String?           @map("entity_type")
  entityId      String?           @map("entity_id")
  auditLogId    String?           @map("audit_log_id")
  createdAt     DateTime          @default(now()) @map("created_at")
  expiresAt     DateTime?         @map("expires_at")
  decayedAt     DateTime?         @map("decayed_at")

  user     User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  auditLog AuditLog? @relation(fields: [auditLogId], references: [id], onDelete: SetNull)

  @@index([userId, createdAt])
  @@index([userId, violationType])
  @@index([expiresAt])
  @@map("user_violations")
}

model ModerationQueue {
  id          String        @id @default(cuid())
  entityType  String        @map("entity_type")
  entityId    String        @map("entity_id")
  priority    QueuePriority @default(p2_medium)
  status      QueueStatus   @default(pending)
  category    String?
  assigneeId  String?       @map("assignee_id")
  assignedAt  DateTime?     @map("assigned_at")
  slaDeadline DateTime?     @map("sla_deadline")
  escalatedAt DateTime?     @map("escalated_at")
  resolvedAt  DateTime?     @map("resolved_at")
  resolverId  String?       @map("resolver_id")
  resolution  String?
  createdAt   DateTime      @default(now()) @map("created_at")

  assignee User? @relation("AssignedModerator", fields: [assigneeId], references: [id], onDelete: SetNull)
  resolver User? @relation("ResolvedModerator", fields: [resolverId], references: [id], onDelete: SetNull)

  @@index([status, priority, createdAt])
  @@index([assigneeId, status])
  @@index([entityType, entityId])
  @@index([slaDeadline])
  @@map("moderation_queue")
}

// ============================================================================
// MODERATION ENUMS
// ============================================================================

enum ViolationType {
  spam
  harassment
  hate_speech
  policy_violation
  copyright
  quality
}

enum ViolationSeverity {
  p0_critical
  p1_severe
  p2_moderate
  p3_minor
}

enum QueuePriority {
  p0_critical
  p1_high
  p2_medium
  p3_low
}

enum QueueStatus {
  pending
  assigned
  in_review
  resolved
  escalated
}
